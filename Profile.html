<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My Account · AI Photo Studio</title>

  <style>
    :root{
      --bg: radial-gradient(circle at top, #1e293b 0, #020617 45%, #020617 100%);
      --card-bg: rgba(15,23,42,0.92);
      --accent: #6366f1;
      --accent-soft: rgba(99,102,241,0.16);
      --accent-strong: #4f46e5;
      --danger: #ef4444;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:system-ui,-apple-system,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:#e5e7eb;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    header{
      position:sticky;
      top:0;
      z-index:20;
      backdrop-filter:blur(14px);
      background:linear-gradient(to right, rgba(15,23,42,0.92), rgba(15,23,42,0.6));
      border-bottom:1px solid rgba(148,163,184,0.2);
      padding:12px 20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }

    nav a{
      color:#e5e7eb;
      text-decoration:none;
      font-size:14px;
      margin-left:18px;
      opacity:.85;
      position:relative;
    }
    nav a:hover{opacity:1;}
    nav a::after{
      content:"";
      position:absolute;
      left:0;
      bottom:-4px;
      width:0;
      height:2px;
      background:linear-gradient(90deg,#6366f1,#22c55e);
      transition:width .18s;
    }
    nav a:hover::after{width:100%;}

    .brand-wrap{display:flex;align-items:center;gap:10px;}
    .logo-dot{
      width:28px;height:28px;border-radius:9px;
      background:conic-gradient(from 210deg, #22c55e, #06b6d4, #6366f1, #a855f7, #22c55e);
      box-shadow:0 0 20px rgba(129,140,248,0.6);
    }
    .brand-title{font-weight:800;font-size:18px;letter-spacing:.04em;}

    .page{flex:1;display:flex;justify-content:center;padding:32px 16px;}
    .shell{
      width:100%;
      max-width:960px;
      display:grid;
      grid-template-columns:minmax(0,3fr) minmax(0,2fr);
      gap:24px;
      animation:fade-up .6s ease-out;
    }
    @media(max-width:768px){.shell{grid-template-columns:1fr;}}

    .card{
      background:var(--card-bg);
      border:1px solid rgba(148,163,184,0.25);
      border-radius:18px;
      padding:22px 20px 20px;
      box-shadow:0 18px 45px rgba(15,23,42,0.7);
      position:relative;
      overflow:hidden;
    }

    .card-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
    }
    .card-title{font-size:18px;font-weight:700;display:flex;align-items:center;gap:8px;}
    .dot-live{
      width:8px;height:8px;border-radius:99px;background:#22c55e;
      box-shadow:0 0 10px rgba(34,197,94,0.9);
      animation:pulse 1.6s infinite;
    }

    .label{font-size:12px;color:#9ca3af;text-transform:uppercase;margin-bottom:4px;}
    .value{font-size:15px;margin-bottom:12px;color:#f9fafb;word-break:break-all;}

    .badge{
      display:inline-flex;align-items:center;
      padding:6px 12px;border-radius:99px;font-size:12px;font-weight:700;margin-bottom:10px;
    }
    .badge.pro{background:rgba(22,163,74,0.16);color:#4ade80;border:1px solid rgba(34,197,94,0.8);}
    .badge.trial{background:rgba(129,140,248,0.18);color:#a5b4fc;border:1px solid rgba(129,140,248,0.85);}
    .badge.free{background:rgba(248,250,252,0.04);color:#e5e7eb;border:1px solid rgba(148,163,184,0.55);}

    .btn{
      display:inline-flex;align-items:center;gap:6px;
      padding:10px 16px;border-radius:999px;
      cursor:pointer;font-size:14px;font-weight:600;
      border:none;
      text-decoration:none;
      margin-top:8px;
    }
    .btn-primary{
      background:linear-gradient(135deg,#6366f1,#22c55e);
      color:white;
      box-shadow:0 12px 30px rgba(79,70,229,0.6);
    }
    .btn-ghost{
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
      border:1px solid rgba(148,163,184,0.6);
    }
    .btn-danger{
      background:rgba(248,113,113,0.12);
      color:#fecaca;
      border:1px solid rgba(248,113,113,0.7);
      margin-top:16px;
    }

    @keyframes fade-up{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:none;}}
    @keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.3);}}
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDsBDuaZ_rl7ro63Fv5gPh37EwSkfh-NqM",
      authDomain: "aiphotostudioapp.firebaseapp.com",
      projectId: "aiphotostudioapp",
      storageBucket: "aiphotostudioapp.appspot.com",
      messagingSenderId: "1056724519182",
      appId: "1:1056724519182:web:93410e1b71a292e531ef5f",
      measurementId: "G-YMB9JJHNBE"
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db   = firebase.firestore();
  </script>
</head>

<body>

<header>
  <div class="brand-wrap">
    <div class="logo-dot"></div>
    <div>
      <div class="brand-title">AI Photo Studio</div>
      <div style="font-size:11px;color:#9ca3af;">Smart background remover & AI editor</div>
    </div>
  </div>

  <nav>
    <a href="/index.html">Editor</a>
    <a href="/gallery.html">My Gallery</a>
    <a href="/profile.html">My Account</a>
  </nav>
</header>

<div class="page">
  <div class="shell">

    <!-- LEFT SIDE -->
    <section class="card">
      <div class="card-header">
        <div class="card-title">
          <span class="dot-live"></span> Account Overview
        </div>
        <span id="planPill" class="badge free">Checking…</span>
      </div>

      <p style="color:#9ca3af;margin-bottom:18px;">
        Manage your subscription, trial, and sign-in details.
      </p>

      <div class="label">Email</div>
      <div id="userEmail" class="value">Loading…</div>

      <div class="label">Account created</div>
      <div id="createdAt" class="value">—</div>

      <div class="label">Current plan</div>
      <div id="planBadge"></div>

      <div id="trialSummary" style="color:#9ca3af;margin-top:6px;"></div>

      <a id="btnStartTrial" class="btn btn-primary" style="display:none;">Start 7-Day Free Trial</a>
      <a id="btnBuy" class="btn btn-ghost" style="display:none;">Upgrade to Pro · £4.99/mo</a>

      <button id="btnLogout" class="btn btn-danger">Sign out</button>
    </section>

    <!-- RIGHT SIDE -->
    <aside class="card">
      <div class="card-header">
        <div class="card-title">Quick Actions</div>
      </div>

      <div class="label">Where to start</div>
      <div class="value">
        • Open the editor and try background removal.<br>
        • Start the trial to unlock HD downloads and remove the watermark.
      </div>

      <a href="/index.html" class="btn btn-ghost">Open Editor</a>
    </aside>

  </div>
</div>

<script>
  const STRIPE_LINK = "https://buy.stripe.com/eVq6oJ3wugiPcFJ7QGd3i02";

  const elEmail     = document.getElementById("userEmail");
  const elCreated   = document.getElementById("createdAt");
  const elPlanBadge = document.getElementById("planBadge");
  const elPlanPill  = document.getElementById("planPill");
  const elTrialSummary = document.getElementById("trialSummary");

  const btnTrial = document.getElementById("btnStartTrial");
  const btnBuy   = document.getElementById("btnBuy");
  const btnLogout = document.getElementById("btnLogout");

  function fmtDate(ts){
    if(!ts) return "—";
    if(ts.toDate) ts = ts.toDate();
    return ts.toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'});
  }

  auth.onAuthStateChanged(async user=>{
    if(!user){
      location.replace("/signin.html");
      return;
    }

    elEmail.textContent = user.email || "No email";

    const ref  = db.collection("users").doc(user.uid);
    const snap = await ref.get();
    const data = snap.data() || {};

    // Creation date
    if(data.createdAt){
      elCreated.textContent = fmtDate(data.createdAt);
    } else {
      elCreated.textContent = fmtDate(new Date(user.metadata.creationTime));
    }

    // Plan logic
    const isPro = data.tier === "pro" || data.isPro === true;
    const trialEndUnix = data.trial?.endsAt?.seconds ? data.trial.endsAt.toMillis() : null;

    if(isPro){
      elPlanPill.textContent = "PRO ACTIVE";
      elPlanPill.className = "badge pro";
      elPlanBadge.innerHTML = `<span class="badge pro">Pro · All features unlocked</span>`;
      elTrialSummary.textContent = "Your subscription is active via Stripe.";
      btnTrial.style.display = "none";
      btnBuy.style.display = "none";
    }
    else if(trialEndUnix && trialEndUnix > Date.now()){
      const days = Math.ceil((trialEndUnix - Date.now()) / 86400000);
      elPlanPill.textContent = "TRIAL ACTIVE";
      elPlanPill.className = "badge trial";
      elPlanBadge.innerHTML = `<span class="badge trial">Trial · ${days} day${days===1?"":"s"} left</span>`;
      elTrialSummary.textContent = `${days} day${days===1?"":"s"} left in your free trial.`;
      btnTrial.style.display = "none";
      btnBuy.style.display = "inline-flex";
      btnBuy.href = STRIPE_LINK;
    }
    else {
      elPlanPill.textContent = "FREE PLAN";
      elPlanPill.className = "badge free";
      elPlanBadge.innerHTML = `<span class="badge free">Free plan</span>`;
      elTrialSummary.textContent = "Start your trial to unlock HD and remove watermark.";
      btnTrial.style.display = "inline-flex";
      btnBuy.style.display = "inline-flex";
      btnBuy.href = STRIPE_LINK;
    }
  });

  btnTrial.onclick = async ()=>{
    const user = auth.currentUser;
    if(!user) return;

    const now = new Date();
    const end = new Date(now.getTime() + 7*86400000);

    await db.collection("users").doc(user.uid).set({
      tier:"trial",
      trial:{
        startsAt: firebase.firestore.Timestamp.fromDate(now),
        endsAt:   firebase.firestore.Timestamp.fromDate(end)
      }
    },{merge:true});

    alert("7-day trial started!");
    location.reload();
  };

  btnLogout.onclick = ()=> auth.signOut();
</script>

</body>
</html>
