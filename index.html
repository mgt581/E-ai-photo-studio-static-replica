<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="x-version" content="v-2025-08-24-12">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Photo Studio</title>

  <!-- PWA & App Icon Support -->
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="/logo-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="/logo-512.png">
  <meta name="theme-color" content="#0ea5e9">

  <style>
    body { margin: 0; font-family: system-ui, sans-serif; background: #f8fafc; color: #0f172a; }
    .wrap { width: 100%; max-width: 1080px; margin: 0 auto; padding: 16px; }
    .hero { text-align: center; margin-bottom: 20px; }
    .card { background: white; padding: 16px; border: 1px solid #e5e7eb; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; }
    .button { background: #4f46e5; color: #fff; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; margin: 5px; }
    .muted { color: #64748b; }
    #status { text-align: center; margin: 10px 0; }
    canvas { display: block; margin: 20px auto; background: white; border: 1px solid #ddd; }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="hero">
      <h1>AI Photo Studio</h1>
      <p class="muted">Enhance your photos with AI-powered editing tools</p>
    </section>

    <!-- Authentication Panel -->
    <div id="authPanel" class="card">
      <h3>Login to Save Your Work</h3>
      <button class="button" id="btnLoginGoogle">Sign in with Google</button>
      <button class="button" id="btnLoginEmail">Sign in with Email</button>
      <button class="button" id="btnLogout" style="display:none">Logout</button>
      <p id="authStatus" class="muted">Not signed in</p>
    </div>

    <!-- Photo Editing UI -->
    <input id="fileInput" type="file" accept="image/*" style="display:block; margin: 0 auto 10px;">
    <p id="status">Upload or input a photo to begin</p>
    <button id="btnHD" class="button" disabled>Download HD</button>
    <canvas id="stage" width="960" height="600"></canvas>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js"></script>

  <script>
    // â€” Placeholder config: inject real values using environment variables or secure build process
    const firebaseConfig = {
      apiKey: "FIREBASE_API_KEY",
      authDomain: "FIREBASE_AUTH_DOMAIN",
      projectId: "FIREBASE_PROJECT_ID",
      storageBucket: "FIREBASE_STORAGE_BUCKET",
      messagingSenderId: "FIREBASE_MESSAGING_SENDER_ID",
      appId: "FIREBASE_APP_ID",
      measurementId: "FIREBASE_MEASUREMENT_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // UI elements
    const authStatus = document.getElementById('authStatus');
    const btnLoginGoogle = document.getElementById('btnLoginGoogle');
    const btnLoginEmail = document.getElementById('btnLoginEmail');
    const btnLogout = document.getElementById('btnLogout');
    const btnHD = document.getElementById('btnHD');
    const statusEl = document.getElementById('status');
    const fileInput = document.getElementById('fileInput');
    const canvas = document.getElementById('stage');
    const ctx = canvas.getContext('2d');

    // Authentication logic
    auth.onAuthStateChanged(user => {
      if (user) {
        authStatus.textContent = `Signed in as ${user.displayName || user.email}`;
        btnLogout.style.display = 'inline-block';
        btnLoginGoogle.style.display = 'none';
        btnLoginEmail.style.display = 'none';
        localStorage.setItem('studio_pro', '1');
        btnHD.disabled = false;
      } else {
        authStatus.textContent = 'Not signed in';
        btnLogout.style.display = 'none';
        btnLoginGoogle.style.display = 'inline-block';
        btnLoginEmail.style.display = 'inline-block';
        localStorage.removeItem('studio_pro');
        btnHD.disabled = true;
      }
    });

    btnLoginGoogle.onclick = async () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      try { await auth.signInWithPopup(provider); } catch { alert('Google sign-in failed.'); }
    };

    btnLoginEmail.onclick = async () => {
      const email = prompt('Enter your email:');
      if (!email) return alert('Email is required');
      const password = prompt('Enter a password:');
      try {
        await auth.signInWithEmailAndPassword(email, password);
      } catch (e) {
        if (e.code === 'auth/user-not-found') {
          await auth.createUserWithEmailAndPassword(email, password);
        } else {
          alert('Email sign-in failed.');
        }
      }
    };

    btnLogout.onclick = () => auth.signOut();

    // Photo upload and canvas logic
    fileInput.onchange = async (e) => {
      if (!e.target.files[0]) return;
      const src = await new Promise(res => {
        const reader = new FileReader();
        reader.onload = () => res(reader.result);
        reader.readAsDataURL(e.target.files[0]);
      });
      const img = new Image();
      img.onload = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        statusEl.textContent = 'Photo loaded!';
      };
      img.src = src;
    };

    btnHD.onclick = () => {
      const link = document.createElement('a');
      link.href = canvas.toDataURL('image/png', .95);
      link.download = 'photo-hd.png';
      link.click();
    };

    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(console.error);
    }
  </script>
</body>
</html>
