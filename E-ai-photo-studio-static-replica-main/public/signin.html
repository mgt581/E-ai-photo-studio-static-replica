<script>
    // 1. Your Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCM6r66kW9xkBA5rgVcz4sP57N2v2BMbkg",
      authDomain: "ai-photo-studio-24354.firebaseapp.com",
      projectId: "ai-photo-studio-24354",
      storageBucket: "ai-photo-studio-24354.appspot.com",
      messagingSenderId: "411346648650",
      appId: "1:411346648650:web:5ecd86ffecd05472fab0b3",
      measurementId: "G-R3G160W8BQ"
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const googleProvider = new firebase.auth.GoogleAuthProvider();
    const emailInput = document.getElementById("email");
    const passInput = document.getElementById("pass");

    // CRITICAL: Check if user is already signed in on load
    auth.onAuthStateChanged(user => {
      if (user) {
        // Redirect if already logged in
        window.location.href = "/index.html"; 
      }
    });

    // 2. Function to handle Email/Password login
    async function loginEmail() {
        // Optional: Add a status message element to show "Signing in..."
        const email = emailInput.value;
        const pass = passInput.value;
        if (!email || !pass) return alert("Please enter both email and password.");

        try {
            // Set persistence (remembers user across sessions)
            await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
            await auth.signInWithEmailAndPassword(email, pass);
            
            // Success: Redirection handled by onAuthStateChanged listener
            // window.location.href = "/index.html";
        } catch (err) {
            alert("Sign In failed: " + err.message);
        }
    }

    // 3. Function to handle Google login
    async function loginGoogle() {
        try {
            await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
            await auth.signInWithPopup(googleProvider);
            
            // Success: Redirection handled by onAuthStateChanged listener
            // window.location.href = "/index.html";
        } catch (err) {
            // Error codes often include 'auth/popup-closed-by-user'
            if (err.code !== 'auth/popup-closed-by-user') {
                alert("Google sign-in failed: " + err.message);
            }
        }
    }
</script>
