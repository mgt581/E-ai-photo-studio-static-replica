<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign in · AI Photo Studio</title>
  <meta name="theme-color" content="#4f46e5" />

  <!-- Icons (optional, match your main site) -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/apple-touch-icon.png">

  <style>
    :root{
      --bg:#0b1020; --card:#0f172a; --text:#e5e7eb; --muted:#94a3b8; --border:#1f2a44;
      --ring:0 16px 40px rgba(59,130,246,.25);
      --grad:linear-gradient(90deg,#6366f1,#8b5cf6);
      --btn:#111827; --btnText:#e5e7eb;
      --accent:#4f46e5;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(1000px 700px at 0% 0%, #1d2340 0%, transparent 60%),
        radial-gradient(1000px 700px at 100% 0%, #141b34 0%, transparent 60%),
        radial-gradient(1000px 700px at 50% 120%, #0a1226 0%, transparent 60%),
        #050816;
      color:var(--text);
    }
    a{color:#93c5fd;text-decoration:none}
    .wrap{min-height:100%; display:grid; place-items:center; padding:32px}
    .card{
      width:100%; max-width:460px;
      background:rgba(13,20,42,0.75);
      border:1px solid rgba(148,163,184,.18);
      border-radius:18px; padding:22px 20px;
      box-shadow:0 10px 40px rgba(2,6,23,.35), inset 0 0 0 1px rgba(255,255,255,0.04);
      backdrop-filter: blur(16px);
    }
    .brand{display:flex;align-items:center;gap:10px;margin-bottom:6px}
    .badge{
      width:38px;height:38px;border-radius:12px;display:grid;place-items:center;
      background:linear-gradient(135deg,#7c3aed,#3b82f6);
      box-shadow:0 10px 30px rgba(79,70,229,.35);
    }
    .title{margin:6px 0 2px;font-size:22px;font-weight:800;letter-spacing:.2px}
    .sub{margin:0 0 8px;color:var(--muted);font-size:14px}
    .row{display:grid;gap:10px;margin-top:14px}
    .btn{
      height:46px; border-radius:12px; border:1px solid rgba(148,163,184,.25);
      background:#0b1227; color:#e5e7eb; font-weight:700; cursor:pointer;
      display:flex; align-items:center; justify-content:center; gap:10px;
    }
    .btn:hover{border-color:#64748b; background:#0d152f}
    .btn.primary{background:var(--grad); border:none; color:white; box-shadow:var(--ring)}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .spacer{text-align:center; color:#94a3b8; font-size:12px; margin:6px 0; position:relative}
    .spacer::before,.spacer::after{
      content:""; height:1px; background:rgba(148,163,184,.25); position:absolute; top:50%; width:38%;
    }
    .spacer::before{left:0} .spacer::after{right:0}
    .field{display:grid; gap:6px}
    .label{font-size:12px; color:#a5b4fc}
    .input{
      height:44px; border-radius:12px; border:1px solid rgba(148,163,184,.25);
      background:#0b1227; color:#e5e7eb; padding:0 12px; outline:none;
    }
    .input:focus{border-color:#818cf8; box-shadow:0 0 0 3px rgba(99,102,241,0.25)}
    .muted{color:#94a3b8; font-size:12px}
    .error{color:#fecaca; font-size:13px; margin-top:4px}
    .topbar{position:fixed; left:0; right:0; top:0; display:flex; justify-content:space-between; padding:8px 14px;}
    .link{color:#a5b4fc}
    #recaptcha-container{display:grid; place-items:center; padding:8px 0}
    .note{font-size:12px; color:#9ca3af; margin-top:8px; text-align:center}
  </style>
</head>
<body>
  <div class="topbar">
    <div><a class="link" href="/">← Back to app</a></div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="brand">
        <div class="badge" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M4 13l6-9 4 6 6-4-6 14-4-7H4z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="title">Sign in to AI Photo Studio</div>
      </div>
      <p class="sub">Choose a sign-in method below. You’ll be redirected back to the editor after signing in.</p>

      <!-- Google -->
      <button id="btnGoogle" class="btn">
        <svg width="18" height="18" viewBox="0 0 48 48" fill="none" aria-hidden="true">
          <path fill="#FFC107" d="M43.611 20.083H42V20H24v8h11.303C33.676 31.91 29.223 35 24 35c-7.18 0-13-5.82-13-13S16.82 9 24 9c3.313 0 6.313 1.253 8.59 3.31l5.657-5.657C35.577 3.042 29.987 1 24 1 10.745 1 0 11.745 0 25s10.745 24 24 24 24-10.745 24-24c0-1.627-.167-3.216-.389-4.917z"/>
          <path fill="#FF3D00" d="M6.306 14.691L12.97 19.6C14.826 15.154 19.06 12 24 12c3.313 0 6.313 1.253 8.59 3.31l5.657-5.657C35.577 3.042 29.987 1 24 1 15.317 1 7.86 5.773 4.003 12.691z"/>
          <path fill="#4CAF50" d="M24 49c5.162 0 9.868-1.977 13.43-5.197l-6.197-5.236C29.012 39.542 26.64 40.5 24 40.5c-5.176 0-9.582-3.497-11.164-8.204l-6.47 4.986C9.224 44.775 16.067 49 24 49z"/>
          <path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303c-1.411 3.316-4.679 5.917-8.303 5.917-2.64 0-5.012-.958-6.827-2.434l-6.47 4.985C16.067 44.775 22.91 49 30 49c11.598 0 19.5-7.902 19.5-19.5 0-1.627-.167-3.216-.389-4.917z"/>
        </svg>
        Continue with Google
      </button>

      <div class="spacer">or</div>

      <!-- Email / password -->
      <div class="row" id="emailBox">
        <div class="field">
          <label class="label" for="email">Email</label>
          <input id="email" class="input" type="email" placeholder="you@example.com" autocomplete="email" />
        </div>
        <div class="field">
          <label class="label" for="password">Password</label>
          <input id="password" class="input" type="password" placeholder="••••••••" autocomplete="current-password" />
        </div>
        <div class="row" style="grid-template-columns:1fr 1fr">
          <button id="btnEmailSignIn" class="btn">Sign in</button>
          <button id="btnEmailSignUp" class="btn">Create account</button>
        </div>
        <div id="emailError" class="error" style="display:none"></div>
      </div>

      <div class="spacer">or</div>

      <!-- Phone -->
      <div class="row" id="phoneBox">
        <div class="field">
          <label class="label" for="phone">Phone number</label>
          <input id="phone" class="input" type="tel" placeholder="+44 7123 456789" autocomplete="tel" />
        </div>
        <div id="recaptcha-container"></div>
        <button id="btnSendCode" class="btn">Send verification code</button>

        <div id="codeSection" class="row" style="display:none">
          <div class="field">
            <label class="label" for="code">Verification code</label>
            <input id="code" class="input" type="text" inputmode="numeric" placeholder="6-digit code" />
          </div>
          <button id="btnVerifyCode" class="btn primary">Verify & Sign in</button>
        </div>
        <div id="phoneError" class="error" style="display:none"></div>
        <div class="note">Tip: in Firebase Console → Auth → Sign-in Method → Phone, add test numbers to avoid SMS quotas during development.</div>
      </div>

      <p class="note">By continuing, you agree to the Terms and acknowledge the Privacy Policy.</p>
    </div>
  </div>

  <!-- Firebase (Compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // ---- Firebase init (same project as index.html) ----
    const firebaseConfig = {
      apiKey: "AIzaSyDsBDuaZ_rl7ro63Fv5gPh37EwSkfh-NqM",
      authDomain: "aiphotostudioapp.firebaseapp.com",
      projectId: "aiphotostudioapp",
      storageBucket: "aiphotostudioapp.appspot.com",
      messagingSenderId: "1056724519182",
      appId: "1:1056724519182:web:93410e1b71a292e531ef5f",
      measurementId: "G-YMB9JJHNBE"
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db   = firebase.firestore();

    // Optional: set the language for SMS/Email templates
    auth.languageCode = 'en';

    // If already signed in → go home
    auth.onAuthStateChanged(user => {
      if (user) {
        // If you want to force e-mail verification before redirect:
        // if (user.email && !user.emailVerified) { /* show message */ return; }
        location.replace('/');
      }
    });

    const $ = (id) => document.getElementById(id);
    const show = (el, on=true) => el.style.display = on ? '' : 'none';

    // ---- Google Sign-in ----
    $('btnGoogle').onclick = async () => {
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        await auth.signInWithPopup(provider);
        // redirect happens in onAuthStateChanged
      } catch (e) {
        alert('Google sign-in failed: ' + e.message);
      }
    };

    // ---- Email / Password ----
    async function emailSignIn(){
      $('emailError').style.display = 'none';
      const email = $('email').value.trim();
      const pass  = $('password').value;
      if (!email || !pass) return ($('emailError').textContent = 'Enter email and password.', $('emailError').style.display='block');
      try {
        await auth.signInWithEmailAndPassword(email, pass);
      } catch (e) {
        $('emailError').textContent = e.message;
        $('emailError').style.display = 'block';
      }
    }
    async function emailSignUp(){
      $('emailError').style.display = 'none';
      const email = $('email').value.trim();
      const pass  = $('password').value;
      if (!email || !pass) return ($('emailError').textContent = 'Enter email and password.', $('emailError').style.display='block');
      try {
        const cred = await auth.createUserWithEmailAndPassword(email, pass);
        try { await cred.user.sendEmailVerification(); } catch {}
      } catch (e) {
        $('emailError').textContent = e.message;
        $('emailError').style.display = 'block';
      }
    }
    $('btnEmailSignIn').onclick = emailSignIn;
    $('btnEmailSignUp').onclick = emailSignUp;

    // ---- Phone Sign-in (with visible reCAPTCHA) ----
    let confirmationResult = null;
    let recaptcha = null;

    function ensureRecaptcha(){
      if (recaptcha) return recaptcha;
      recaptcha = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
        size: 'normal',
        callback: () => { /* solved */ },
        'expired-callback': () => { recaptcha.reset(); }
      });
      recaptcha.render();
      return recaptcha;
    }

    $('btnSendCode').onclick = async () => {
      $('phoneError').style.display = 'none';
      const phone = $('phone').value.trim();
      if (!phone) return ($('phoneError').textContent = 'Enter a phone number including country code.', $('phoneError').style.display='block');
      try {
        ensureRecaptcha();
        confirmationResult = await auth.signInWithPhoneNumber(phone, recaptcha);
        show($('codeSection'), true);
      } catch (e) {
        $('phoneError').textContent = e.message;
        $('phoneError').style.display = 'block';
        try { recaptcha && recaptcha.reset(); } catch {}
      }
    };

    $('btnVerifyCode').onclick = async () => {
      $('phoneError').style.display = 'none';
      if (!confirmationResult) return;
      const code = $('code').value.trim();
      if (!code) return ($('phoneError').textContent = 'Enter the SMS code you received.', $('phoneError').style.display='block');
      try {
        await confirmationResult.confirm(code);
        // redirect happens in onAuthStateChanged
      } catch (e) {
        $('phoneError').textContent = e.message;
        $('phoneError').style.display = 'block';
      }
    };
  </script>
</body>
</html>
